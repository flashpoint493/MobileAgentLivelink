# PC 服务启动指南

## 步骤 1: 安装依赖

由于网络问题，如果 `pip install` 失败，可以尝试以下方法：

### 方法 1: 使用国内镜像源（推荐）
```powershell
pip install -r requirements.txt -i https://pypi.tuna.tsinghua.edu.cn/simple --trusted-host pypi.tuna.tsinghua.edu.cn
```

### 方法 2: 手动安装每个包
```powershell
pip install websockets -i https://pypi.tuna.tsinghua.edu.cn/simple
pip install pyautogui -i https://pypi.tuna.tsinghua.edu.cn/simple
pip install pygetwindow -i https://pypi.tuna.tsinghua.edu.cn/simple
pip install pynput -i https://pypi.tuna.tsinghua.edu.cn/simple
pip install python-dotenv -i https://pypi.tuna.tsinghua.edu.cn/simple
pip install pyperclip  # 注意：这个包在 requirements.txt 中缺失，但代码需要
```

### 方法 3: 如果网络正常，直接安装
```powershell
pip install -r requirements.txt
```

## 步骤 2: 配置和启动

### 方法 1: 使用启动脚本（推荐）

1. 编辑 `启动.bat` 文件，修改以下配置：
   ```batch
   REM 中转服务器地址
   SET SERVER_IP=your-server-ip-or-domain
   SET SERVER_PORT=8765
   
   REM 配对密钥（必填！）
   SET AUTH_TOKEN=your_secret_token_here
   
   REM 设备ID（可选）
   SET DEVICE_ID=default-pc
   
   REM 项目根目录（用于读取上下文文件，可选）
   SET PROJECT_ROOT=
   ```

2. 双击 `启动.bat` 文件启动服务

### 方法 2: 手动启动

1. 设置环境变量：
   ```powershell
   $env:RELAY_SERVER_URL="ws://your-server-ip:8765/ws"
   $env:AUTH_TOKEN="your_secret_token_here"
   $env:DEVICE_ID="default-pc"
   ```

2. 运行服务：
   ```powershell
   cd pc-client
   python relay_client.py
   ```

### 配置说明

- `RELAY_SERVER_URL` / `SERVER_IP`: 中继服务器地址（必填）
- `AUTH_TOKEN`: 配对密钥（**必填**，用于安全配对，防止未授权访问）
- `DEVICE_ID`: 设备ID（可选，用于标识此PC）
- `PROJECT_ROOT`: 项目根目录（可选，用于读取上下文文件，留空则使用默认值）

## 注意事项

1. **确保 Cursor IDE 已安装并运行**
   - PC 服务需要找到 Cursor 窗口才能工作
   - 窗口标题应该包含 "Cursor"

2. **中继服务器地址**
   - 本地测试：使用 `ws://localhost:8765/ws`
   - 生产环境：需要部署中继服务器到公网，然后修改配置

3. **防火墙设置**
   - 确保允许 Python 访问网络

4. **依赖问题**
   - 如果遇到 `ModuleNotFoundError`，说明依赖未安装成功
   - 检查 `pip list` 确认所有包都已安装

## 故障排查

- **连接失败**: 检查中继服务器是否运行，URL 是否正确
- **找不到 Cursor 窗口**: 确保 Cursor IDE 已打开
- **导入错误**: 重新安装缺失的依赖包



